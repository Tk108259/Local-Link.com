<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Business Details — LocalLink</title>
  <style>
    :root{
      --bg:#f8fafc;
      --card:#fff;
      --accent:#7c3aed;
      --muted:#475569;
      --radius:14px;
      --shadow: 0 8px 34px rgba(34,60,98,0.08);
    }
    body{
      margin:0;font-family:Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial; background:var(--bg); color:#0f172a;
      -webkit-font-smoothing:antialiased; padding:18px;
    }
    .wrap{max-width:1000px;margin:0 auto}
    .back{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    .back a{color:var(--accent);text-decoration:none;font-weight:600}
    .panel{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;display:grid;grid-template-columns:360px 1fr;gap:18px;align-items:start}
    @media (max-width:900px){ .panel{grid-template-columns:1fr} }
    .gallery{
      position:relative;display:flex;flex-direction:column;gap:10px;
    }
    .main{
      width:100%;height:360px;border-radius:12px;object-fit:cover;background:#eef2ff;border:1px solid #eef2ff;
      transition:transform .26s ease; touch-action:pan-y;
    }
    @media (max-width:900px){ .main{height:240px} }
    .thumbs{display:flex;gap:8px;overflow:auto}
    .thumbs img{width:84px;height:58px;object-fit:cover;border-radius:8px;border:2px solid transparent;cursor:pointer}
    .thumbs img.selected{border-color:var(--accent);box-shadow:0 10px 30px rgba(124,58,237,0.12)}
    .info h1{margin:0 0 8px 0;font-size:1.6rem}
    .meta-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    .price{color:var(--accent);font-weight:700}
    .services ul{margin:8px 0 0 18px;color:var(--muted)}
    .actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .btn{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
    .btn.ghost{background:#fff;color:var(--accent);border:1px solid #efe8ff}
    .stars{color:#fbbf24;font-size:1.1rem}
    .placeholder{display:flex;align-items:center;justify-content:center;background:#eef2ff;height:240px;border-radius:10px;color:#93c5fd}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="back"><a href="Business listings.html" id="backLink">← Back to listings</a></div>

    <section class="panel" id="panel">
      <div class="gallery" id="gallery">
        <img id="mainImage" class="main" alt="Business image" src="" />
        <div class="thumbs" id="thumbs" aria-label="Gallery thumbnails"></div>
      </div>

      <aside class="info" id="info">
        <h1 id="bizName">Business</h1>
        <div class="meta-row">
          <div class="stars" id="bizStars">★★★★★</div>
          <div class="price" id="bizPrice"></div>
        </div>
        <div class="desc" id="bizDesc" style="color:var(--muted)"></div>
        <div class="services" id="bizServices"></div>
        <div class="actions">
          <button id="contactBtn" class="btn">Contact on WhatsApp</button>
          <button id="rateBtn" class="btn ghost">Rate</button>
        </div>
      </aside>
    </section>
  </div>

  <script>
    // Keep same sample data as listings
    const BUSINESSES = {
      BreadBaddie: {
        key: 'BreadBaddie',
        name: 'Bread Baddie',
        images: ['images/Baking_Baddie.jpg','images/Scones.jpg','images/Bannana Bread.jpg'],
        stars: 5,
        desc: "Bespoke bakery specialising in artisan banana bread, scones and crunchies.",
        price: 'R150',
        services: ['Banana bread','Scones','Cookies & crunchies'],
        whatsapp: '27814343732'
      },
      SweetBakesSA: {
        key: 'SweetBakesSA',
        name: 'Baking With Hlogi',
        images: ['images/Hlogi_sample1.jpg','images/Hlogi_Sample 3.jpg','images/Baking_Hlogi sample.jpg'],
        stars: 4,
        desc: 'Freshly baked treats and custom cakes by Hlogi. Perfect for any occasion!',
        price: 'R300 — R800',
        services: ['Custom Cakes','Pastries','Event Catering'],
        whatsapp: '27815265309'
      }
    };

    const PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent(
      '<svg xmlns="http://www.w3.org/2000/svg" width="900" height="600" viewBox="0 0 900 600">' +
      '<rect width="900" height="600" fill="#f3f4f6"/>' +
      '<text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="28">Image unavailable</text>' +
      '</svg>'
    );

    function q(name){ return new URLSearchParams(location.search).get(name); }
    function findBizKey(query){
      if(!query) return null;
      const qn = query.toString().replace(/\s+/g,'').toLowerCase();
      return Object.keys(BUSINESSES).find(k => k.replace(/\s+/g,'').toLowerCase() === qn || (BUSINESSES[k].name||'').replace(/\s+/g,'').toLowerCase() === qn);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const param = q('biz') || '';
      const key = findBizKey(param) || param || 'BreadBaddie';
      const biz = BUSINESSES[key] || BUSINESSES['BreadBaddie'];

      const mainImage = document.getElementById('mainImage');
      const thumbs = document.getElementById('thumbs');
      const bizName = document.getElementById('bizName');
      const bizDesc = document.getElementById('bizDesc');
      const bizPrice = document.getElementById('bizPrice');
      const bizServices = document.getElementById('bizServices');
      const bizStars = document.getElementById('bizStars');

      // fill text
      bizName.innerText = biz.name;
      bizDesc.innerText = biz.desc || '';
      bizPrice.innerText = biz.price || '';
      bizStars.innerText = '★'.repeat(Math.max(0,Math.min(5,biz.stars))) + '☆'.repeat(5 - Math.max(0,Math.min(5,biz.stars)));
      bizServices.innerHTML = '<strong>Services</strong><ul>' + (biz.services || []).map(s => `<li>${s}</li>`).join('') + '</ul>';

      // images
      function safeLoad(el, src){
        el.src = src || PLACEHOLDER;
        el.onerror = ()=> el.src = PLACEHOLDER;
      }
      const imgs = biz.images && biz.images.length ? biz.images.slice() : [];
      if(!imgs.length){ safeLoad(mainImage, PLACEHOLDER); thumbs.innerHTML = ''; }
      else {
        safeLoad(mainImage, imgs[0]);
        thumbs.innerHTML = '';
        imgs.forEach((src, i)=>{
          const t = document.createElement('img');
          t.src = src;
          t.alt = biz.name + ' thumb ' + (i+1);
          t.className = i===0 ? 'selected' : '';
          t.addEventListener('click', ()=> {
            mainImage.classList.add('fade');
            mainImage.src = src;
            document.querySelectorAll('.thumbs img').forEach(x=>x.classList.remove('selected'));
            t.classList.add('selected');
          });
          t.onerror = ()=> { t.src = PLACEHOLDER; t.alt = 'Image not found'; };
          thumbs.appendChild(t);
        });
      }

      // swipe support for main image (pointer events)
      let down = false, startX = 0, lastIndex = 0;
      function currentIndex(){ const selected = thumbs.querySelector('img.selected'); if(!selected) return 0; return Array.from(thumbs.children).indexOf(selected); }
      function showIndex(i){
        const clamped = ((i % imgs.length) + imgs.length) % imgs.length;
        mainImage.src = imgs[clamped] || PLACEHOLDER;
        document.querySelectorAll('.thumbs img').forEach((x, idx)=> x.classList.toggle('selected', idx===clamped));
      }
      mainImage.addEventListener('pointerdown', (e)=>{ down=true; startX = e.clientX; mainImage.setPointerCapture(e.pointerId); });
      mainImage.addEventListener('pointerup', (e)=>{ if(!down) return; down=false; const diff = e.clientX - startX; const thr = 40; if(diff > thr) showIndex(currentIndex()-1); else if(diff < -thr) showIndex(currentIndex()+1); });
      mainImage.addEventListener('pointercancel', ()=> down=false);

      // keyboard arrows for images
      mainImage.tabIndex = 0;
      mainImage.addEventListener('keydown', (e)=>{ if(e.key==='ArrowRight') showIndex(currentIndex()+1); if(e.key==='ArrowLeft') showIndex(currentIndex()-1); });

      document.getElementById('contactBtn').addEventListener('click', ()=>{
        const number = biz.whatsapp || '27711234567';
        const msg = encodeURIComponent(`Hi, I'm interested in your services (${biz.name})`);
        window.open(`https://wa.me/${number}?text=${msg}`, '_blank');
      });

      // Rate button opens small prompt (simple)
      document.getElementById('rateBtn').addEventListener('click', ()=>{
        const r = prompt('Rate this business 1–5', '');
        const v = parseInt(r,10);
        if(!isNaN(v) && v>=1 && v<=5){
          localStorage.setItem('listing_rating_' + biz.key, v);
          alert('Thanks — your rating is saved locally.');
        } else if(r!==null){
          alert('Please enter a number between 1 and 5.');
        }
      });

      // If the page was opened via "View gallery" highlight behavior: nothing extra required because biz param used
    });
  </script>
</body>
</html>
